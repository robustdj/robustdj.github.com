<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[robustdj.github.com]]></title>
  <link href="http://localhost:9292/atom.xml" rel="self"/>
  <link href="http://localhost:9292/"/>
  <updated>2013-03-31T00:58:36-07:00</updated>
  <id>http://localhost:9292/</id>
  <author>
    <name><![CDATA[Derrick Camerino]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Rails 3 Cheat Sheet]]></title>
    <link href="http://localhost:9292/blog/2010/12/29/rails-3-cheat-sheet/"/>
    <updated>2010-12-29T23:45:00-08:00</updated>
    <id>http://localhost:9292/blog/2010/12/29/rails-3-cheat-sheet</id>
    <content type="html"><![CDATA[<p>Envy Labs just released some Rails 3 cheat sheets to aid the API usage of several components. The pdf can be found
<a href="http://blog.envylabs.com/post/29044764623/rails-3-cheat-sheets">here</a>.</p>

<h3>ROUTING API</h3>

<h2>Basic Routing</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">YourApp</span><span class="p">:</span><span class="ss">:Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">resources</span> <span class="ss">:posts</span>
</span><span class='line'>  <span class="n">match</span> <span class="s1">&#39;/all&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;posts#index&#39;</span>
</span><span class='line'>  <span class="n">root</span> <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="s2">&quot;home#index&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Optional Parameters</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">match</span> <span class="s1">&#39;/posts/(/:yy(/:mm))&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;posts#index&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">PostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>    <span class="c1"># params[:yy]</span>
</span><span class='line'>    <span class="c1"># params[:mm]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Nested Routes</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">namespace</span> <span class="ss">:api</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">namespace</span> <span class="ss">:internal</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">resources</span> <span class="ss">:accounts</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">resources</span> <span class="ss">:orders</span>
</span><span class='line'>      <span class="n">member</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">get</span>  <span class="ss">:summary</span>
</span><span class='line'>        <span class="n">post</span> <span class="ss">:suspend</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="n">post</span> <span class="ss">:confirm</span><span class="p">,</span> <span class="ss">:on</span> <span class="o">=&gt;</span> <span class="ss">:member</span>
</span><span class='line'>      <span class="n">collection</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">get</span> <span class="ss">:pending</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="n">get</span> <span class="ss">:blocked</span><span class="p">,</span> <span class="ss">:on</span> <span class="o">=&gt;</span> <span class="ss">:collection</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Redirection</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">match</span> <span class="s1">&#39;/sign_out&#39;</span>     <span class="o">=&gt;</span> <span class="n">redirect</span><span class="p">(</span><span class="s2">&quot;/signout&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">match</span> <span class="s1">&#39;/users/:name&#39;</span>  <span class="o">=&gt;</span> <span class="n">redirect</span> <span class="p">{</span><span class="o">|</span><span class="n">params</span><span class="o">|</span> <span class="s2">&quot;/</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
</span><span class='line'><span class="n">match</span> <span class="s1">&#39;/google&#39;</span>       <span class="o">=&gt;</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;http://google.com&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Named Routes</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">match</span> <span class="s1">&#39;/sign_in&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;session#new&#39;</span><span class="p">,</span> <span class="ss">:as</span> <span class="o">=&gt;</span> <span class="s1">&#39;sign_in&#39;</span> <span class="c1"># Gives you sign_in_path helper</span>
</span><span class='line'><span class="n">match</span> <span class="s1">&#39;/reset_password/:token&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;users#reset_password&#39;</span><span class="p">,</span> <span class="ss">:as</span> <span class="o">=&gt;</span> <span class="s1">&#39;reset_password&#39;</span> <span class="c1"># Gives reset_password_path(&#39;key&#39;)</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Rack Routing</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">get</span> <span class="s1">&#39;/hello&#39;</span>          <span class="o">=&gt;</span> <span class="nb">proc</span> <span class="p">{</span><span class="o">|</span><span class="n">env</span><span class="o">|</span> <span class="o">[</span><span class="mi">200</span><span class="p">,</span> <span class="p">{},</span> <span class="s2">&quot;Hello Rack&quot;</span><span class="o">]</span><span class="p">}</span>
</span><span class='line'><span class="n">get</span> <span class="s1">&#39;/rack_endpoint&#39;</span>  <span class="o">=&gt;</span> <span class="no">PostsController</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="ss">:index</span><span class="p">)</span>
</span><span class='line'><span class="n">get</span> <span class="s1">&#39;/rack_app&#39;</span>       <span class="o">=&gt;</span> <span class="no">CustomRackApp</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Constraints</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">match</span> <span class="s1">&#39;/:year&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;posts#index&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:constraints</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:year</span> <span class="o">=&gt;</span> <span class="sr">/\d{4}/</span><span class="p">,</span> <span class="ss">:ip</span> <span class="o">=&gt;</span> <span class="sr">/192\.168\.1\.\d{1,3}/</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">constraints</span><span class="p">(</span><span class="ss">:host</span> <span class="o">=&gt;</span> <span class="sr">/localhost/</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">resources</span> <span class="ss">:posts</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">constraints</span> <span class="no">IpRestrictor</span> <span class="k">do</span> <span class="c1"># Responds to self.matches?(request)</span>
</span><span class='line'>  <span class="n">get</span> <span class="s1">&#39;admin/accounts&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;queenbee#accounts&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Legacy Route</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">match</span> <span class="s1">&#39;/:controller(/:action(/:id(.:format)))&#39;</span> <span class="c1"># Commented out by default</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Scope</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">scope</span> <span class="s1">&#39;:token&#39;</span><span class="p">,</span> <span class="ss">:token</span> <span class="o">=&gt;</span> <span class="sr">/\w{5}/</span> <span class="k">do</span> <span class="c1"># Requires token parameter to get to resources and must by 5 alphanumeric characters</span>
</span><span class='line'>  <span class="n">resources</span> <span class="ss">:rooms</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">resources</span> <span class="ss">:meetings</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">scope</span> <span class="s1">&#39;(:locale)&#39;</span><span class="p">,</span> <span class="ss">:locale</span> <span class="o">=&gt;</span> <span class="sr">/en|pl/</span> <span class="k">do</span> <span class="c1"># Local is optional for these routes</span>
</span><span class='line'>  <span class="n">resources</span> <span class="ss">:posts</span>
</span><span class='line'>  <span class="n">root</span> <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="s1">&#39;posts#index&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>BUNDLER</h3>

<h2>Bundler Commands</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">bundle</span>
</span><span class='line'><span class="s1">&#39;Make sure all dependencies in your Gemfile are available to your application. If they are not available, go install them.</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="s1">$ bundle --without </span>
</span><span class='line'><span class="s1">&#39;</span><span class="no">Installs</span> <span class="n">everything</span> <span class="n">except</span> <span class="n">gems</span> <span class="n">included</span> <span class="k">in</span> <span class="o">.</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="err">$</span> <span class="n">bundle</span> <span class="o">--</span><span class="n">deployment</span>
</span><span class='line'><span class="s1">&#39;Isolates all gems into vendor/bundle, requires up-to-date Gemfile.lock, use gems in vendor/cache if they exist.  </span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="s1">$ bundle check</span>
</span><span class='line'><span class="s1">&#39;</span><span class="no">Checks</span> <span class="k">if</span> <span class="n">the</span> <span class="n">dependencies</span> <span class="n">listed</span> <span class="k">in</span> <span class="no">Gemfile</span> <span class="n">are</span> <span class="n">satisfied</span> <span class="n">by</span> <span class="n">currently</span> <span class="n">installed</span> <span class="n">gems</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="err">$</span> <span class="n">bundle</span> <span class="n">show</span> <span class="o">[</span><span class="n">gem_name</span><span class="o">]</span>
</span><span class='line'><span class="s1">&#39;Shows all libraries which are included by the Gemfile and their dependencies. If [gem_name] is given, shows where it is located in the filesystem.  </span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="s1">$ bundle open   </span>
</span><span class='line'><span class="s1">&#39;</span><span class="no">Opens</span> <span class="n">the</span> <span class="n">gem</span> <span class="n">source</span> <span class="k">in</span> <span class="n">the</span> <span class="n">default</span> <span class="n">editor</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="err">$</span> <span class="n">bundle</span> <span class="n">update</span> <span class="o">[</span><span class="n">gem_name</span><span class="o">]</span>
</span><span class='line'><span class="s1">&#39;Recreates Gemfile.lock and runs &#39;</span><span class="n">bundle</span><span class="s1">&#39; to install new dependencies.  </span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="s1">$ bundle package</span>
</span><span class='line'><span class="s1">&#39;</span><span class="no">Copies</span> <span class="n">all</span> <span class="n">project</span> <span class="n">gems</span> <span class="n">to</span> <span class="n">vendor</span><span class="o">/</span><span class="n">cache</span><span class="o">/</span> <span class="o">--</span> <span class="n">use</span> <span class="n">this</span> <span class="k">if</span> <span class="n">you</span> <span class="n">don</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">want</span> <span class="n">to</span> <span class="n">rely</span> <span class="n">on</span> <span class="n">external</span> <span class="n">servers</span> <span class="k">for</span> <span class="n">deployment</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Gemfile Syntax</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">source</span> <span class="s2">&quot;http://rubygems.org&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">gem</span> <span class="s2">&quot;hpricot&quot;</span><span class="p">,</span> <span class="s2">&quot;0.6&quot;</span>
</span><span class='line'><span class="n">gem</span> <span class="s2">&quot;sqlite3-ruby&quot;</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="s2">&quot;sqlite3&quot;</span>
</span><span class='line'><span class="n">gem</span> <span class="s2">&quot;local_gem&quot;</span><span class="p">,</span> <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s2">&quot;~/Sites/local_gem&quot;</span>
</span><span class='line'><span class="n">gem</span> <span class="s2">&quot;rails&quot;</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s2">&quot;git://github.com/rails/rails.git&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Additional parameters</span>
</span><span class='line'><span class="c1"># :branch =&gt; &quot;branch_name&quot;</span>
</span><span class='line'><span class="c1"># :tag =&gt; &quot;tag_number&quot;</span>
</span><span class='line'><span class="c1"># :ref =&gt; &quot;ref_number&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">git</span> <span class="s2">&quot;git://github.com/rails/rails.git&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1"># only these two gems will be fetched from the git repository</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s2">&quot;railties&quot;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s2">&quot;active_model&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s2">&quot;webrat&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Creating a gemset for your app</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">rvm</span> <span class="n">use</span> <span class="n">_ruby_version_</span>
</span><span class='line'><span class="err">$</span> <span class="n">rvm</span> <span class="n">gemset</span> <span class="n">create</span> <span class="n">_name_</span>
</span><span class='line'><span class="err">$</span> <span class="n">rvm</span> <span class="n">gemset</span> <span class="n">use</span> <span class="n">_name_</span>
</span><span class='line'><span class="err">$</span> <span class="n">gem</span> <span class="n">install</span> <span class="n">bundler</span>
</span><span class='line'><span class="err">$</span> <span class="n">bundle</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Workflow</h3>

<h2>Developing a new application</h2>

<ol>
<li>$ cd new_app/</li>
<li>$ bundle init # creates a new Gemfile</li>
<li>Add project dependencies</li>
<li>Check Gemfile and Gemfile.lock into VCS</li>
</ol>


<p>After adding or removing dependencies from Gemfile</p>

<ol>
<li>$ bundle</li>
<li><p>Commit Gemfile and Gemfile.lock
After modifying existing dependency versions</p></li>
<li><p>$ bundle update</p></li>
<li>Commit Gemfile and Gemfile.lock
Deploying your application</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">bundle</span> <span class="n">pacakge</span> <span class="c1"># locally  </span>
</span></code></pre></td></tr></table></div></figure>


<p>Copies all app gems to vendor/cache</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">bundle</span> <span class="c1"># server  </span>
</span></code></pre></td></tr></table></div></figure>


<p>Installs gems from vendor/cache - no external server communication</p>

<p>For more info, visit <a href="http://gembundler.com">http://gembundler.com</a></p>

<h3>ACTIVERELATION</h3>

<h2>Lazy Loading</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vi">@posts</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:published</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">)</span>
</span><span class='line'><span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:order</span><span class="o">]</span>
</span><span class='line'>  <span class="vi">@posts</span> <span class="o">=</span> <span class="vi">@posts</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:order</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="vi">@posts</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span><span class="o">|</span><span class="nb">p</span><span class="o">|</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">posts</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:order</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'><span class="vi">@published</span> <span class="o">=</span> <span class="n">posts</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:published</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">)</span>
</span><span class='line'><span class="vi">@unpublished</span> <span class="o">=</span> <span class="n">posts</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:published</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>CRUD Methods</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="kp">new</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
</span><span class='line'><span class="n">create</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
</span><span class='line'><span class="n">create!</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
</span><span class='line'><span class="n">find</span><span class="p">(</span><span class="n">id_or_array</span><span class="p">)</span>
</span><span class='line'><span class="n">destroy</span><span class="p">(</span><span class="n">id_or_array</span><span class="p">)</span>
</span><span class='line'><span class="n">destroy_all</span>
</span><span class='line'><span class="n">delete</span><span class="p">(</span><span class="n">id_or_array</span><span class="p">)</span>
</span><span class='line'><span class="n">delete_all</span>
</span><span class='line'><span class="n">update</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">updates</span><span class="p">)</span>
</span><span class='line'><span class="n">update_all</span><span class="p">(</span><span class="n">updates</span><span class="p">)</span>
</span><span class='line'><span class="n">exists?</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">sports_posts</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:category</span> <span class="o">=&gt;</span> <span class="s1">&#39;sports&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">new_sports_post</span> <span class="o">=</span> <span class="n">sports_posts</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="n">new_sports_post</span><span class="o">.</span><span class="n">category</span> <span class="c1"># =&gt; &#39;sports&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">sports_posts</span><span class="o">.</span><span class="n">update_all</span><span class="p">(</span><span class="ss">:published</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">)</span>
</span><span class='line'><span class="n">sports_posts</span><span class="o">.</span><span class="n">exists?</span> <span class="c1"># =&gt; true</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Chain Methods</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">where</span>
</span><span class='line'><span class="n">having</span>
</span><span class='line'><span class="nb">select</span>
</span><span class='line'><span class="n">group</span>
</span><span class='line'><span class="n">order</span>
</span><span class='line'><span class="n">limit</span>
</span><span class='line'><span class="n">offset</span>
</span><span class='line'><span class="n">joins</span>
</span><span class='line'><span class="n">includes</span>
</span><span class='line'><span class="n">lock</span>
</span><span class='line'><span class="n">readonly</span>
</span><span class='line'><span class="n">from</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Chaining</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vi">@posts</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:published</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:order</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="vi">@joe_posts</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:auther</span> <span class="o">=&gt;</span> <span class="s2">&quot;Joe&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">includes</span><span class="p">(</span><span class="ss">:comments</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">all</span> <span class="c1"># .all forces query execution and returns an array, not a relation</span>
</span></code></pre></td></tr></table></div></figure>


<h2>(Named) Scopes</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">default_scope</span> <span class="n">order</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">scope</span> <span class="ss">:published</span><span class="p">,</span> <span class="n">where</span><span class="p">(</span><span class="ss">:published</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">)</span>
</span><span class='line'>  <span class="n">scope</span> <span class="ss">:unpublished</span><span class="p">,</span> <span class="n">where</span><span class="p">(</span><span class="ss">:published</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Deprecated</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">find</span><span class="p">(</span><span class="n">id_or_array</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span> <span class="c1"># All options are now sent using the chain methods</span>
</span><span class='line'><span class="n">find</span><span class="p">(</span><span class="ss">:first</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span class='line'><span class="n">find</span><span class="p">(</span><span class="ss">:all</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span class='line'><span class="n">first</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
</span><span class='line'><span class="n">all</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
</span><span class='line'><span class="n">update_all</span><span class="p">(</span><span class="n">updates</span><span class="p">,</span> <span class="n">conditions</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>XSS PROTECTION &amp; UJS</h3>

<h2>XSS Protection</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= @post.body # safe by default %&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sx">&lt;%=</span> <span class="n">raw</span><span class="p">(</span><span class="vi">@post</span><span class="o">.</span><span class="n">body</span><span class="p">)</span> <span class="c1"># unsafe %&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="sx">%= link_to raw(&quot;&lt;span class=</span><span class="s1">&#39;cart&#39;</span><span class="o">&gt;</span><span class="c1">#{h @user_input}&lt;/span&gt;&quot;), cart_path # only h @user_input escaped, not the spans %&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Unobtrusive JS</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Show&#39;</span><span class="p">,</span> <span class="vi">@post</span><span class="p">,</span> <span class="ss">:remote</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x"># =&gt; &lt;a href=&quot;/posts/1&quot; data-remote=&quot;true&quot;&gt;Show&lt;/a&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@post</span><span class="p">,</span> <span class="ss">:remote</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x"># =&gt; &lt;form action=&quot;/posts&quot; class=&quot;new_post&quot; data-remote=&quot;true&quot; id=&quot;new_post&quot; method=&quot;posts&quot;&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Destroy&#39;</span><span class="p">,</span> <span class="vi">@post</span><span class="p">,</span> <span class="ss">:method</span> <span class="o">=&gt;</span> <span class="ss">:delete</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x"># =&gt; &lt;a href=&quot;/posts/1&quot; data-method=&quot;delete&quot; rel=&quot;nofollow&quot;&gt;Destroy&lt;/a&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Destroy&#39;</span><span class="p">,</span> <span class="vi">@post</span><span class="p">,</span> <span class="ss">:confirm</span> <span class="o">=&gt;</span> <span class="s1">&#39;Are you sure?&#39;</span><span class="p">,</span> <span class="ss">:method</span> <span class="o">=&gt;</span> <span class="ss">:delete</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x"># =&gt; &lt;a href=&quot;/posts/1&quot; data-confirm=&quot;Are you sure?&quot; data-method=&quot;delete&quot; rel=&quot;nofollow&quot;&gt;Destroy&lt;/a&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="ss">:disable_with</span> <span class="o">=&gt;</span> <span class="s2">&quot;Please wait...&quot;</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x"># =&gt; &lt;input data-disable-with=&quot;Please wait...&quot; id=&quot;post_submit&quot; name=&quot;commit&quot; type=&quot;submit&quot; value=&quot;Create Post&quot; /&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>HTML5 Custom Data Attributes</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">data</span><span class="o">-</span><span class="n">remote</span>
</span><span class='line'><span class="n">data</span><span class="o">-</span><span class="n">confirm</span>
</span><span class='line'><span class="n">data</span><span class="o">-</span><span class="nb">method</span>
</span><span class='line'><span class="n">data</span><span class="o">-</span><span class="n">disable</span><span class="o">-</span><span class="n">with</span>
</span><span class='line'><span class="c1"># Parsed by JavaScript drivers -- defaults to rails.js</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Deprecated</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">link_to_remote</span>
</span><span class='line'><span class="n">remote_form_for</span>
</span><span class='line'><span class="n">observe_field</span>
</span><span class='line'><span class="n">observe_form</span>
</span><span class='line'><span class="n">form_remote_tag</span>
</span><span class='line'><span class="n">button_to_remote</span>
</span><span class='line'><span class="n">submit_to_remote</span>
</span><span class='line'><span class="n">link_to_function</span>
</span><span class='line'><span class="n">periodically_call_remote</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># If you need to use any of the deprecated helpers, visit http://github.com/rails/prototype_legacy_helper</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Using JQuery</h2>

<p>Go to <a href="https://github.com/rails/jquery-ujs">https://github.com/rails/jquery-ujs</a> for instructions</p>

<h3>ACTIONMAILER &amp; ACTIONCONTROLLER</h3>

<h2>Rails Mail Generator</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">rails</span> <span class="n">generate</span> <span class="n">mail</span> <span class="no">UserMail</span> <span class="n">welcome</span> <span class="n">forgot_password</span>
</span><span class='line'><span class="c1"># Creates:</span>
</span><span class='line'><span class="c1"># app/mailers/user_mailer.rb</span>
</span><span class='line'><span class="c1"># app/views/user_mailer/welcome.text.erb</span>
</span><span class='line'><span class="c1"># app/views/user_mailer/forgot_password.text.erb</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Basic Mailer Syntax</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="ss">ActionMailer</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">welcome</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">subdomain</span><span class="p">)</span>
</span><span class='line'>    <span class="c1"># instance variables are available within your view</span>
</span><span class='line'>    <span class="vi">@user</span> <span class="o">=</span> <span class="n">user</span>
</span><span class='line'>    <span class="vi">@subdomain</span> <span class="o">=</span> <span class="n">subdomain</span>
</span><span class='line'>    <span class="n">mail</span><span class="p">(</span><span class="ss">:from</span> <span class="o">=&gt;</span> <span class="s1">&#39;admin@app.com&#39;</span><span class="p">,</span>
</span><span class='line'>         <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="vi">@user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
</span><span class='line'>         <span class="ss">:subject</span> <span class="o">=&gt;</span> <span class="s1">&#39;Welcome&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Delivering Messages</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">UserMailer</span><span class="o">.</span><span class="n">welcome</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">subdomain</span><span class="p">)</span><span class="o">.</span><span class="n">deliver</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># or</span>
</span><span class='line'>
</span><span class='line'><span class="n">message</span> <span class="o">=</span> <span class="no">UserMailer</span><span class="o">.</span><span class="n">welcome</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">subdomain</span><span class="p">)</span>
</span><span class='line'><span class="n">message</span><span class="o">.</span><span class="n">deliver</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Defaults and Attachments</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="ss">ActionMailer</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">default</span> <span class="ss">:from</span> <span class="o">=&gt;</span> <span class="s1">&#39;admin@test.com&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="ss">:reply_to</span> <span class="o">=&gt;</span> <span class="s1">&#39;noreply@test.com&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;X-Time-Code&quot;</span> <span class="o">=&gt;</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">to_i</span><span class="o">.</span><span class="n">to_s</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">welcome</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">subdomain</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@user</span> <span class="o">=</span> <span class="n">user</span>
</span><span class='line'>    <span class="vi">@subdomain</span> <span class="o">=</span> <span class="n">subdomain</span>
</span><span class='line'>    <span class="n">attachments</span><span class="o">[</span><span class="s1">&#39;test.pdf&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;public/test.pdf&#39;</span><span class="p">))</span>
</span><span class='line'>    <span class="n">attachments</span><span class="o">[</span><span class="s1">&#39;photo.jpg&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="n">generate_image</span><span class="p">()</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">mail</span><span class="p">(</span><span class="ss">:to</span> <span class="o">=&gt;</span> <span class="vi">@user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="ss">:subject</span> <span class="o">=&gt;</span> <span class="s1">&#39;Welcome to TestApp&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
</span><span class='line'>      <span class="c1"># Defaults to: welcome.html.erb, welcome.text.erb</span>
</span><span class='line'>      <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="p">{</span> <span class="n">render</span> <span class="s1">&#39;other_html_welcome&#39;</span> <span class="p">}</span>
</span><span class='line'>      <span class="nb">format</span><span class="o">.</span><span class="n">text</span> <span class="p">{</span> <span class="n">render</span> <span class="s1">&#39;other_text_welcome&#39;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>respond_to and respond_with</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="n">respond_to</span> <span class="ss">:html</span><span class="p">,</span> <span class="ss">:json</span><span class="p">,</span> <span class="ss">:only</span> <span class="o">=&gt;</span> <span class="ss">:index</span>
</span><span class='line'>  <span class="n">respond_to</span> <span class="ss">:xml</span><span class="p">,</span> <span class="ss">:except</span> <span class="o">=&gt;</span> <span class="ss">:index</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>    <span class="n">respond_with</span><span class="p">(</span><span class="vi">@users</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">all</span><span class="p">,</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="ss">:ok</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:user</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>    <span class="n">respond_with</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="p">{</span> <span class="n">redirect_to</span><span class="p">(</span><span class="n">users_path</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ACTIVEMODEL</h3>

<h2>Modules</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">AttributeMethods</span>
</span><span class='line'><span class="no">Callbacks</span>
</span><span class='line'><span class="no">Dirty</span>
</span><span class='line'><span class="no">Errors</span>
</span><span class='line'><span class="no">Naming</span>
</span><span class='line'><span class="no">Observing</span>
</span><span class='line'><span class="no">Serialization</span>
</span><span class='line'><span class="no">Validations</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Dirty</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Person</span>
</span><span class='line'>  <span class="kp">include</span> <span class="ss">ActiveModel</span><span class="p">:</span><span class="ss">:Dirty</span>
</span><span class='line'>  <span class="n">define_attribute_methods</span> <span class="o">[</span><span class="ss">:name</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">name</span>
</span><span class='line'>    <span class="vi">@name</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">name</span><span class="o">=</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</span><span class='line'>    <span class="n">name_will_change!</span>
</span><span class='line'>    <span class="vi">@name</span> <span class="o">=</span> <span class="n">val</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">save</span>
</span><span class='line'>    <span class="vi">@previously_changed</span> <span class="o">=</span> <span class="n">changes</span>
</span><span class='line'>    <span class="vi">@changed_attributes</span><span class="o">.</span><span class="n">clear</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span class='line'><span class="n">person</span><span class="o">.</span><span class="n">changed?</span> <span class="c1"># =&gt; false</span>
</span><span class='line'>
</span><span class='line'><span class="n">person</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Bob&#39;</span>
</span><span class='line'><span class="n">person</span><span class="o">.</span><span class="n">changed?</span> <span class="c1"># =&gt; true</span>
</span><span class='line'>
</span><span class='line'><span class="n">person</span><span class="o">.</span><span class="n">name_changed?</span> <span class="c1"># =&gt; true</span>
</span><span class='line'>
</span><span class='line'><span class="n">person</span><span class="o">.</span><span class="n">name_was</span> <span class="c1"># =&gt; &#39;Uncle Bob&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">person</span><span class="o">.</span><span class="n">name_change</span> <span class="c1"># =&gt; [&#39;Uncle Bob&#39;, &#39;Bob&#39;]</span>
</span><span class='line'>
</span><span class='line'><span class="n">person</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Bill&#39;</span>
</span><span class='line'><span class="n">person</span><span class="o">.</span><span class="n">name_change</span> <span class="c1"># =&gt; [&#39;Uncle Bob&#39;, &#39;Bill&#39;]</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Validations</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Person</span>
</span><span class='line'>  <span class="kp">include</span> <span class="ss">ActiveModel</span><span class="p">:</span><span class="ss">:Validations</span>
</span><span class='line'>  <span class="kp">attr_accessor</span>
</span><span class='line'>  <span class="n">validates_presence_of</span> <span class="ss">:email</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="nb">p</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span> <span class="c1"># =&gt; #</span>
</span><span class='line'><span class="nb">p</span><span class="o">.</span><span class="n">valid?</span> <span class="c1"># =&gt; false</span>
</span><span class='line'><span class="nb">p</span><span class="o">.</span><span class="n">errors</span> <span class="c1"># =&gt; {:email =&gt; [&quot;can&#39;t be blank&quot;]}</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>SHORTCUTS</em></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">validates</span> <span class="ss">:terms</span><span class="p">,</span> <span class="ss">:acceptance</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'><span class="n">validates</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">:confirmation</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'><span class="n">validates</span> <span class="ss">:username</span><span class="p">,</span> <span class="ss">:exclusion</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:in</span> <span class="o">=&gt;</span> <span class="sx">%w(admin)</span> <span class="p">}</span>
</span><span class='line'><span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:format</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="sr">/\A[^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})\Z/i</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:on</span> <span class="o">=&gt;</span> <span class="ss">:create</span> <span class="p">}</span>
</span><span class='line'><span class="n">validates</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">:inclusion</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:in</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">9</span> <span class="p">}</span>
</span><span class='line'><span class="n">validates</span> <span class="ss">:first_name</span><span class="p">,</span> <span class="ss">:length</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:maximum</span> <span class="o">=&gt;</span> <span class="mi">30</span> <span class="p">}</span>
</span><span class='line'><span class="n">validates</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">:numericality</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'><span class="n">validates</span> <span class="ss">:username</span><span class="p">,</span> <span class="ss">:presence</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'><span class="n">validates</span> <span class="ss">:username</span><span class="p">,</span> <span class="ss">:uniqueness</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Serialization</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Person</span>
</span><span class='line'>  <span class="kp">include</span> <span class="ss">ActiveModel</span><span class="p">:</span><span class="ss">:Serializers</span><span class="o">::</span><span class="no">JSON</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:name</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">attributes</span>
</span><span class='line'>    <span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="nb">name</span><span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nb">p</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span> <span class="c1"># =&gt; #</span>
</span><span class='line'><span class="nb">p</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Gregg&quot;</span> <span class="c1"># =&gt; &quot;Gregg&quot;</span>
</span><span class='line'><span class="nb">p</span><span class="o">.</span><span class="n">to_json</span> <span class="o">=&gt;</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">name</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">Gregg</span><span class="se">\&quot;</span><span class="s2">}&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Callbacks</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Person</span>
</span><span class='line'>  <span class="kp">extend</span> <span class="ss">ActiveModel</span><span class="p">:</span><span class="ss">:Callbacks</span>
</span><span class='line'>  <span class="n">define_model_callbacks</span> <span class="ss">:save</span>
</span><span class='line'>  <span class="n">before_save</span> <span class="ss">:action_before_save</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">save</span>
</span><span class='line'>    <span class="n">_run_save_callbacks</span> <span class="k">do</span>
</span><span class='line'>      <span class="c1"># Your save action methods here</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">action_before_save</span>
</span><span class='line'>    <span class="c1"># Your code here</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Encapsulating Application Config Variables in a YAML File]]></title>
    <link href="http://localhost:9292/blog/2010/12/13/encapsulating-application-config-variables-in-a-yaml-file/"/>
    <updated>2010-12-13T23:41:00-08:00</updated>
    <id>http://localhost:9292/blog/2010/12/13/encapsulating-application-config-variables-in-a-yaml-file</id>
    <content type="html"><![CDATA[<p>Having different configurations for different environments can get messy especially as your project grows. Environment files
start to get long and switching between all the different files becomes a hassle. One technique I like is to encapsulate all
of the configuration variables in a YAML file and then loading it up into a global hash during initialization.</p>

<p>I recently dealt with a case using paperclip and had different settings depending on the environment. On production servers
we wanted to use s3 for storage and locally we wanted to use the filesystem. At first we set up constants (to hold paperclip
settings) in each of our environment files. So we had something like this in each of our environment(<code>test.rb</code>,
<code>development.rb</code>, <code>production.rb</code>, etc) files:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">PAPERCLIP_STORAGE_OPTIONS</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="ss">:storage</span> <span class="o">=&gt;</span> <span class="ss">:s3</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:s3_credentials</span> <span class="o">=&gt;</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">/config/s3.yml&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:styles</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:original</span> <span class="o">=&gt;</span> <span class="s2">&quot;800x600&gt;&quot;</span><span class="p">,</span> <span class="ss">:medium</span> <span class="o">=&gt;</span> <span class="s2">&quot;300x300#&quot;</span><span class="p">,</span> <span class="ss">:thumb</span> <span class="o">=&gt;</span> <span class="s2">&quot;100x100#&quot;</span>
</span><span class='line'>  <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s2">&quot;/user_images/:id/:style/:filename&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:convert_options</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:all</span> <span class="o">=&gt;</span> <span class="s2">&quot;-strip&quot;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>In translating it to YAML (<code>config/config.yml</code> in my case), it looked like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">paperclip_storage_options</span><span class="p-Indicator">:</span> <span class="nl">&amp;paperclip</span>
</span><span class='line'>  <span class="l-Scalar-Plain">styles</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">original</span><span class="p-Indicator">:</span> <span class="s">&quot;800x600&gt;&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">medium</span><span class="p-Indicator">:</span> <span class="s">&quot;300x300#&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">thumb</span><span class="p-Indicator">:</span> <span class="s">&quot;100x100#&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">path</span><span class="p-Indicator">:</span> <span class="s">&quot;:rails_root/public/user_images/:id/:style/:filename&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">convert_options</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">all</span><span class="p-Indicator">:</span> <span class="s">&quot;-strip&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">defaults</span><span class="p-Indicator">:</span> <span class="nl">&amp;defaults</span>
</span><span class='line'>  <span class="l-Scalar-Plain">paperclip_storage_options</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">&lt;&lt;</span><span class="p-Indicator">:</span> <span class="nv">*paperclip</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">deployed_defaults</span><span class="p-Indicator">:</span> <span class="nl">&amp;deployed_defaults</span>
</span><span class='line'>  <span class="l-Scalar-Plain">&lt;&lt;</span><span class="p-Indicator">:</span> <span class="nv">*defaults</span>
</span><span class='line'>  <span class="l-Scalar-Plain">paperclip_storage_options</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">&lt;&lt;</span><span class="p-Indicator">:</span> <span class="nv">*paperclip</span>
</span><span class='line'>    <span class="l-Scalar-Plain">storage</span><span class="p-Indicator">:</span> <span class="s">&quot;s3&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">s3_credentials</span><span class="p-Indicator">:</span> <span class="s">&quot;&lt;%=</span><span class="nv"> </span><span class="s">RAILS_ROOT</span><span class="nv"> </span><span class="s">%&gt;/config/s3.yml&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">development</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">&lt;&lt;</span><span class="p-Indicator">:</span> <span class="nv">*defaults</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">test</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">&lt;&lt;</span><span class="p-Indicator">:</span> <span class="nv">*defaults</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">qa</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">&lt;&lt;</span><span class="p-Indicator">:</span> <span class="nv">*deployed_defaults</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">production</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">&lt;&lt;</span><span class="p-Indicator">:</span> <span class="nv">*deployed_defaults</span>
</span></code></pre></td></tr></table></div></figure>


<p>And so now each environment can have its own configurations and its nicely encapsulated in one file. You may notice that we
have embedded ruby in the YAML file. We just have to feed it into ERB when we load the YAML. Lets take a look at
<code>config/initializers/config.rb</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">APP_CONFIG</span> <span class="o">=</span> <span class="no">YAML</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="no">ERB</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">/config/config.yml&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">result</span><span class="p">)</span><span class="o">[</span><span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">].</span><span class="n">recursive_symbolize_keys</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can actually ignore the recursive_symbolize_keys, as I only had to do that since paperclip only takes symbolized
arguments. While this snippet of code isnt the prettiest, it works well and enables global config encapsulation. First
its reading the YAML file, interpreting the ruby code, converting it into a hash, and then finally storing it into a
constant.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hash#recursive_symbolize_keys]]></title>
    <link href="http://localhost:9292/blog/2010/12/13/hash-number-recursive-symbolize-keys/"/>
    <updated>2010-12-13T23:38:00-08:00</updated>
    <id>http://localhost:9292/blog/2010/12/13/hash-number-recursive-symbolize-keys</id>
    <content type="html"><![CDATA[<p>Surprisingly there isnt a <code>Hash#recursive_symbolize_keys</code> method so heres code to accomplish that:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Hash</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">recursive_symbolize_keys</span>
</span><span class='line'>    <span class="n">symbolize_keys!</span>
</span><span class='line'>    <span class="n">values</span><span class="o">.</span><span class="n">select</span><span class="p">{</span><span class="o">|</span><span class="n">v</span><span class="o">|</span> <span class="n">v</span><span class="o">.</span><span class="n">is_a?</span> <span class="no">Hash</span><span class="p">}</span><span class="o">.</span><span class="n">each</span><span class="p">{</span><span class="o">|</span><span class="n">h</span><span class="o">|</span> <span class="n">h</span><span class="o">.</span><span class="n">recursive_symbolize_keys</span><span class="p">}</span>
</span><span class='line'>    <span class="nb">self</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Sometimes gems/plugins only take arguments in the form of symbols so this can method can be handy if you have some
sort of nested config hash.</p>

<p>Credits to: <a href="http://grosser.it/2009/04/14/recursive-symbolize_keys/">http://grosser.it/2009/04/14/recursive-symbolize_keys/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using Bundler with Capistrano]]></title>
    <link href="http://localhost:9292/blog/2010/12/11/using-bundler-with-capistrano/"/>
    <updated>2010-12-11T23:37:00-08:00</updated>
    <id>http://localhost:9292/blog/2010/12/11/using-bundler-with-capistrano</id>
    <content type="html"><![CDATA[<p>To make capistrano build your gems with bundler you can use the following code snippet:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">namespace</span> <span class="ss">:bundle</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:install</span><span class="p">,</span> <span class="ss">:roles</span> <span class="o">=&gt;</span> <span class="ss">:app</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">shared_dir</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">shared_path</span><span class="p">,</span> <span class="s1">&#39;bundle&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">run</span> <span class="s2">&quot;mkdir -p </span><span class="si">#{</span><span class="n">shared_dir</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="n">run</span> <span class="s2">&quot;cd </span><span class="si">#{</span><span class="n">release_path</span><span class="si">}</span><span class="s2"> &amp;&amp; bundle install --without development test --path </span><span class="si">#{</span><span class="n">shared_dir</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">after</span> <span class="s1">&#39;deploy:update_code&#39;</span><span class="p">,</span> <span class="s1">&#39;bundle:install&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Of course, this is assuming that you already have bundler installed on your remote server.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Sunspot (Solr) on Rails 3]]></title>
    <link href="http://localhost:9292/blog/2010/12/06/sunspot-solr-on-rails-3/"/>
    <updated>2010-12-06T23:30:00-08:00</updated>
    <id>http://localhost:9292/blog/2010/12/06/sunspot-solr-on-rails-3</id>
    <content type="html"><![CDATA[<p>Sunspot is a ruby driver for <a href="http://lucene.apache.org/solr/">Solr</a> and is pretty easy to integrate into rails using
<a href="https://github.com/outoftime/sunspot_rails">sunspot_rails</a>.</p>

<h2>Installation</h2>

<p>First add it to your Gemfile:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s2">&quot;sunspot_rails&quot;</span><span class="p">,</span> <span class="s2">&quot;1.2.rc4&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Update your bundle:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bundle</span> <span class="n">install</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run this task to create your <code>sunspot.yml</code> file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">rails</span> <span class="n">g</span> <span class="n">sunspot_rails</span><span class="ss">:install</span>
</span></code></pre></td></tr></table></div></figure>


<p>To start the sunspot server run:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">rake</span> <span class="ss">sunspot</span><span class="p">:</span><span class="ss">solr</span><span class="p">:</span><span class="n">start</span> <span class="no">RAILS_ENV</span><span class="o">=</span><span class="n">development</span>
</span></code></pre></td></tr></table></div></figure>


<p>You probably dont need the rails env variable set but I usually do it to be explicit. The first time you run this command,
it will create a <code>solr/ directory</code> in your Rails root. This contains Solrs configuration, as well as the actual data files
for the Solr index. Youll probably want to add <code>solr/data</code> to your <code>.gitignore</code>.</p>

<h2>Setting up your Models</h2>

<p>There are two ways to setup your models for indexing. First way (and more appropriate for rails) is to use the searchable macro. Suppose we have a model called Provider with first_name, middle_name, and last_name columns in the database. We can setup those fields to indexing with the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Provider</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">searchable</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">text</span> <span class="ss">:first_name</span> <span class="ss">:middle_name</span><span class="p">,</span> <span class="ss">:last_name</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The second way is the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Sunspot</span><span class="o">.</span><span class="n">setup</span> <span class="no">Provider</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">text</span> <span class="ss">:first_name</span><span class="p">,</span> <span class="ss">:middle_name</span><span class="p">,</span> <span class="ss">:last_name</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This code can be stored at the end of the model (outside of the class), or in an initializer, though it isnt too pretty.
For more information on setting up classes with search and indexing, check out this <a href="https://github.com/outoftime/sunspot">page</a></p>

<h2>Dont Forget to Reindex</h2>

<p>To reindex, run the following rake task:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">rake</span> <span class="ss">sunspot</span><span class="p">:</span><span class="n">reindex</span> <span class="no">RAILS_ENV</span><span class="o">=</span><span class="n">development</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can also reindex in the console by running:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Provider</span><span class="o">.</span><span class="n">reindex</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Testing Provider search with RSpec</h2>

<p>Normally I use <code>before(:each)</code> blocks to set up my data, but setting up search data is a use case for using a <code>before(:all)</code>
block. With search, were not manipulating the data, so having test data setup before all search specs is not only
acceptable, but efficient. Below are specs for testing that a provider can be found by all parts of his/her name:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">describe</span> <span class="s2">&quot;search&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">before</span><span class="p">(</span><span class="ss">:all</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>    <span class="vi">@provider</span> <span class="o">=</span> <span class="no">Factory</span><span class="p">(</span><span class="ss">:provider</span><span class="p">,</span> <span class="ss">:first_name</span> <span class="o">=&gt;</span> <span class="s2">&quot;Dexter&quot;</span><span class="p">,</span> <span class="ss">:middle_name</span> <span class="o">=&gt;</span> <span class="s2">&quot;Berry&quot;</span><span class="p">,</span> <span class="ss">:last_name</span> <span class="o">=&gt;</span> <span class="s2">&quot;Pilsner&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="no">Provider</span><span class="o">.</span><span class="n">reindex</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">it</span> <span class="s2">&quot;should find a provider by first name&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="no">Provider</span><span class="o">.</span><span class="n">search</span><span class="p">{</span> <span class="n">fulltext</span> <span class="s1">&#39;dexter&#39;</span> <span class="p">}</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="o">[</span><span class="vi">@provider</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">it</span> <span class="s2">&quot;should find a provider by middle name&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="no">Provider</span><span class="o">.</span><span class="n">search</span><span class="p">{</span> <span class="n">fulltext</span> <span class="s1">&#39;berry&#39;</span> <span class="p">}</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="o">[</span><span class="vi">@provider</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">it</span> <span class="s2">&quot;should find a provider by first name&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="no">Provider</span><span class="o">.</span><span class="n">search</span><span class="p">{</span> <span class="n">fulltext</span> <span class="s1">&#39;pilsner&#39;</span> <span class="p">}</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="o">[</span><span class="vi">@provider</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>One gotcha. Dont forget to start your sunspot server in the test environment:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">rake</span> <span class="ss">sunspot</span><span class="p">:</span><span class="ss">solr</span><span class="p">:</span><span class="n">start</span> <span class="no">RAILS_ENV</span><span class="o">=</span><span class="nb">test</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using .rvmrc]]></title>
    <link href="http://localhost:9292/blog/2010/12/06/using-rvmrc/"/>
    <updated>2010-12-06T23:27:00-08:00</updated>
    <id>http://localhost:9292/blog/2010/12/06/using-rvmrc</id>
    <content type="html"><![CDATA[<p>If youre not already using <a href="https://rvm.io/">RVM</a>, Id highly recommend it as it makes it easier to manage different versions of ruby. You can
have different projects running on different versions of ruby and switch rubies with ease. One way to make this easier is to
make use of the .rvmrc file. It will automatically switch to the ruby version that your project is running on when you cd
into it.</p>

<p>Suppose we have a rails project called donut running on ruby 1.9.2.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd donut</span></code></pre></td></tr></table></div></figure>


<p>Once in the rails root of the project, create a file called <code>.rvmrc</code> and add this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rvm use ruby-1.9.2-p0@donut --create</span></code></pre></td></tr></table></div></figure>


<p>To list known rubies you can use this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rvm list known</span></code></pre></td></tr></table></div></figure>


<p>Now when you cd into the directory, it will automatically use ruby 1.9.2.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd ..
</span><span class='line'>cd donut
</span><span class='line'>
</span><span class='line'>info: Using ruby 1.9.2 p0 with gemset donut</span></code></pre></td></tr></table></div></figure>


<p>Notice that it is using the gemset donut. Gemsets are basically compartmentalized ruby setups. Gems installed in this gemset
will be separated from other projects (assuming they use different gemsets). You can read more about it
<a href="https://rvm.io/gemsets/">here</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Loading and Dumping a MySQL Database]]></title>
    <link href="http://localhost:9292/blog/2010/12/05/loading-and-dumping-a-mysql-database/"/>
    <updated>2010-12-05T23:25:00-08:00</updated>
    <id>http://localhost:9292/blog/2010/12/05/loading-and-dumping-a-mysql-database</id>
    <content type="html"><![CDATA[<p>You can dump the database into a file using:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysqldump -h hostname -u user --password=password databasename &gt; filename</span></code></pre></td></tr></table></div></figure>


<p>You can load the dump into the database using:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql -h hostname -u user --password=password databasename &lt; filename</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Large Numbers in Ruby]]></title>
    <link href="http://localhost:9292/blog/2010/12/03/large-numbers-in-ruby/"/>
    <updated>2010-12-03T23:23:00-08:00</updated>
    <id>http://localhost:9292/blog/2010/12/03/large-numbers-in-ruby</id>
    <content type="html"><![CDATA[<p>When dealing with large numbers you can use an underscore (in place of a comma) to make the numbers more
readable and easier to write.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">dollars</span> <span class="o">=</span> <span class="mi">1_000_000</span><span class="o">.</span><span class="mo">00</span>
</span><span class='line'><span class="c1"># =&gt;  1000000.0</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Difference Between Include and Extend in Ruby]]></title>
    <link href="http://localhost:9292/blog/2010/11/20/difference-between-include-and-extend-in-ruby/"/>
    <updated>2010-11-20T23:17:00-08:00</updated>
    <id>http://localhost:9292/blog/2010/11/20/difference-between-include-and-extend-in-ruby</id>
    <content type="html"><![CDATA[<p>A common thing to do in ruby is to share functionality among classes. Since ruby doesnt support multiple inheritance, we
simply import code by mixing in modules. So instead of classes having a crazy inheritance tree, they can have includes
and/or extends at the top of the class. But what is the difference between include and extend?</p>

<p>They both mix in functionality into a class, but they are added to different places. Include mixes functionality into
instances of a class, whereas extend mixes functionality into a class itself.</p>

<p>Take a look at the following example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">Explosion</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">explode</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;BOOM!&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Dynamite</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Explosion</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Dynamite</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">explode</span> <span class="c1"># =&gt; BOOM!</span>
</span><span class='line'><span class="no">Dynamite</span><span class="o">.</span><span class="n">explode</span> <span class="c1"># =&gt; NoMethodError: undefined method `explode&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Bomb</span>
</span><span class='line'>  <span class="kp">extend</span> <span class="no">Explosion</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Bomb</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">explode</span> <span class="c1"># =&gt; NoMethodError: undefined method `explode&#39;</span>
</span><span class='line'><span class="no">Bomb</span><span class="o">.</span><span class="n">explode</span> <span class="c1"># =&gt; BOOM!</span>
</span></code></pre></td></tr></table></div></figure>


<p>And of course with ruby being dynamic and all, you can include and/or extend modules at run time</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Chemical</span><span class="p">;</span><span class="k">end</span><span class="p">;</span>
</span><span class='line'><span class="no">Chemical</span><span class="o">.</span><span class="n">extend</span> <span class="no">Explosion</span>
</span><span class='line'><span class="no">Chemical</span><span class="o">.</span><span class="n">explode</span> <span class="c1"># =&gt; BOOM!</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Class#include method is private so we have to use a workaround</span>
</span><span class='line'><span class="no">Chemical</span><span class="o">.</span><span class="n">include</span> <span class="no">Explosion</span>
</span><span class='line'><span class="c1"># =&gt; NoMethodError: private method `include&#39; called</span>
</span><span class='line'>
</span><span class='line'><span class="no">Chemical</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="ss">:include</span><span class="p">,</span> <span class="no">Explosion</span><span class="p">)</span>
</span><span class='line'><span class="no">Chemical</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">explode</span> <span class="c1"># =&gt; BOOM!</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you want more information on include and extend check out the following links:</p>

<ul>
<li><a href="http://www.railstips.org/blog/archives/2009/05/15/include-vs-extend-in-ruby/">Include vs Extend in Ruby by John Nunemaker</a></li>
<li><a href="http://rubyquicktips.com/post/1133877859/include-vs-extend">Include vs Extend by Ruby Quicktips</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Caching with Instance Variables]]></title>
    <link href="http://localhost:9292/blog/2010/11/17/caching-with-instance-variables/"/>
    <updated>2010-11-17T23:13:00-08:00</updated>
    <id>http://localhost:9292/blog/2010/11/17/caching-with-instance-variables</id>
    <content type="html"><![CDATA[<p>A performance trick that I use a lot, especially in models, is memoizing methods that are expensive. Usually
these are methods that hit the database, make external API calls, involve longs loops, etc. Suppose we have a
model Song that has a genre column in the database and a method jazz that queries for all songs that have the
genre <code>jazz</code>. The model would look something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Song</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">jazz</span>
</span><span class='line'>    <span class="n">all</span><span class="p">(</span><span class="ss">:conditions</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:genre</span> <span class="o">=&gt;</span> <span class="s2">&quot;jazz&quot;</span><span class="p">})</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now this looks all fine and dandy but what if that method gets called several times? It will cause a query every
time and will slow down performance.</p>

<h2>Memoization to the Rescue</h2>

<p>We can trade space for time by saving the results in an instance variable. So the first time the method is called, a query to the database will be executed. However all subsequent calls to the method will not query the database and will just return the saved result. That would look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Song</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">jazz</span>
</span><span class='line'>    <span class="vi">@jazz</span> <span class="o">||=</span> <span class="n">all</span><span class="p">(</span><span class="ss">:conditions</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:genre</span> <span class="o">=&gt;</span> <span class="s2">&quot;jazz&quot;</span><span class="p">})</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Clearing the cache!</h2>

<p>A common problem with caching is forgetting to clear it. Whenever a new song gets added, deleted, or modified, were going to need to clear the <code>@jazz</code> instance variable so that when the jazz method is called, it will get those new songs. Easy enough, we can just add callbacks to clear the cache after saving. Check it out:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Song</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">after_save</span> <span class="ss">:clear_memoization</span>
</span><span class='line'>  <span class="n">after_destroy</span> <span class="ss">:clear_memoization</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">jazz</span>
</span><span class='line'>    <span class="vi">@jazz</span> <span class="o">||=</span> <span class="n">all</span><span class="p">(</span><span class="ss">:conditions</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:genre</span> <span class="o">=&gt;</span> <span class="s2">&quot;jazz&quot;</span><span class="p">})</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">clear_memoization</span>
</span><span class='line'>    <span class="vi">@jazz</span> <span class="o">=</span> <span class="kp">nil</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Enumberable#group_by]]></title>
    <link href="http://localhost:9292/blog/2010/11/07/enumberable-number-group-by/"/>
    <updated>2010-11-07T23:09:00-08:00</updated>
    <id>http://localhost:9292/blog/2010/11/07/enumberable-number-group-by</id>
    <content type="html"><![CDATA[<p>So I have another boy on the way and I was trying to think up of names so I created a ruby script to pick a
random name out of a file beginning with a letter that you provide as an argument. So you&#8217;d call the script like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ruby boy_name.rb <span class="nv">s</span>
</span><span class='line'><span class="o">=</span>&gt; Sylen
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># using ruby 1.8.7</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="no">ARGV</span><span class="o">.</span><span class="n">empty?</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;USAGE: ruby boy_name.rb &lt;letter&gt;&quot;</span>
</span><span class='line'>  <span class="nb">exit</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">file</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;boy_names.txt&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">names</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">to_a</span><span class="o">.</span><span class="n">group_by</span><span class="p">{</span><span class="o">|</span><span class="nb">name</span><span class="o">|</span> <span class="nb">name</span><span class="o">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="o">]</span><span class="p">}</span>
</span><span class='line'><span class="n">selected_names</span> <span class="o">=</span> <span class="n">names</span><span class="o">[</span><span class="no">ARGV</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">capitalize</span><span class="o">]</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">selected_names</span><span class="o">[</span><span class="nb">rand</span><span class="p">(</span><span class="n">selected_names</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>What&#8217;s cool about it is this line</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">names</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">to_a</span><span class="o">.</span><span class="n">group_by</span><span class="p">{</span><span class="o">|</span><span class="nb">name</span><span class="o">|</span> <span class="nb">name</span><span class="o">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="o">]</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>Enumberable#group_by</code> will group elements in an array by the result of the block passed in. In this case, we&#8217;re grouping by
the first letter.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="sx">%w{apple banana cucumber}</span><span class="o">.</span><span class="n">group_by</span><span class="p">{</span><span class="o">|</span><span class="n">fruit</span><span class="o">|</span> <span class="n">fruit</span><span class="o">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="o">]</span><span class="p">}</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#&lt;OrderedHash {&quot;a&quot;=&gt;[&quot;apple&quot;], &quot;b&quot;=&gt;[&quot;banana&quot;], &quot;c&quot;=&gt;[&quot;cucumber&quot;]}&gt;</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Deleting Tags with Git]]></title>
    <link href="http://localhost:9292/blog/2010/11/06/deleting-tags-with-git/"/>
    <updated>2010-11-06T23:07:00-07:00</updated>
    <id>http://localhost:9292/blog/2010/11/06/deleting-tags-with-git</id>
    <content type="html"><![CDATA[<p>You can list tags by running this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git tag</span></code></pre></td></tr></table></div></figure>


<p>Suppose we see a tag called v1.0.1 that we want to remove. Wed simply remove it like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git tag -d v1.0.1
</span><span class='line'>git push origin :refs/tags/v1.0.1</span></code></pre></td></tr></table></div></figure>


<p>The first line will remove the tag locally and the second line will remove the remote tag.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[For Loops in the Terminal]]></title>
    <link href="http://localhost:9292/blog/2010/11/05/for-loops-in-the-terminal/"/>
    <updated>2010-11-05T23:05:00-07:00</updated>
    <id>http://localhost:9292/blog/2010/11/05/for-loops-in-the-terminal</id>
    <content type="html"><![CDATA[<p>Recently I&#8217;ve had to retrieve information from a set of remote servers. Using the for loop in the terminal,
I was able to get all the information I needed in one line which was very convenient. I used the following
code snippet:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>for i in 1 2 3 4 5 6 7 8; do echo "search$i"; ssh root@search$i 'ls -alhrt /ip/sphinx_index/production'; done</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Enable Logging to Rails Console]]></title>
    <link href="http://localhost:9292/blog/2010/10/09/enable-logging-to-rails-console/"/>
    <updated>2010-10-09T23:02:00-07:00</updated>
    <id>http://localhost:9292/blog/2010/10/09/enable-logging-to-rails-console</id>
    <content type="html"><![CDATA[<p>To have the rails log output to the console you can add this to your <code>~/.irbrc</code> file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;logger&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="no">ENV</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s1">&#39;RAILS_ENV&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="no">Object</span><span class="o">.</span><span class="n">const_defined?</span><span class="p">(</span><span class="s1">&#39;RAILS_DEFAULT_LOGGER&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="c1"># for rails 2</span>
</span><span class='line'>  <span class="no">RAILS_DEFAULT_LOGGER</span> <span class="o">=</span> <span class="no">Logger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">STDOUT</span><span class="p">)</span>
</span><span class='line'><span class="k">elsif</span> <span class="n">defined?</span><span class="p">(</span><span class="no">Rails</span><span class="p">)</span>
</span><span class='line'>  <span class="c1"># for rails 3</span>
</span><span class='line'>  <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="no">Logger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">STDOUT</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This only enables the log on the machine youre currently on. If you want to enable logging to the console as a project
wide feature so that anyone who checks out the project and runs the console also gets logging, then you can put this in
your <code>environment.rb</code> file (or an environment config file like <code>development.rb</code>):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">if</span> <span class="s2">&quot;irb&quot;</span> <span class="o">==</span> <span class="vg">$0</span>
</span><span class='line'>  <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="no">Logger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">STDOUT</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Deleting Branches with Git]]></title>
    <link href="http://localhost:9292/blog/2010/10/03/deleting-branches-with-git/"/>
    <updated>2010-10-03T22:50:00-07:00</updated>
    <id>http://localhost:9292/blog/2010/10/03/deleting-branches-with-git</id>
    <content type="html"><![CDATA[<p>Suppose we have a remote and local branch called foo. To delete it locally, just run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git branch -D foo</span></code></pre></td></tr></table></div></figure>


<p>You can verify that it has been deleted by listing your local branches. To do that, run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git branch</span></code></pre></td></tr></table></div></figure>


<p>To delete the remote branch run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git push origin :foo</span></code></pre></td></tr></table></div></figure>


<p>To list all branches (including remotes) run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git branch -a</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
</feed>
